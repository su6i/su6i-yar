---
name: moltbot-orchestration
description: Moltbot Orchestration Technical Encyclopedia: Multi-Agent DAGs, Stateful Handoffs, and Cross-Modal Sync Protocols.
---

# Skill: Moltbot Orchestration (Technical Encyclopedia)

[Back to README](../../README.md)

Comprehensive technical protocols for the "Moltbot" orchestration layerâ€”the executive producer in the AutoStream Pro architecture. This document defines the standards for multi-agent coordination, stateful task decomposition, and cross-modal synchronization between LLMs, Python engines, and media APIs.

---

## 1. Moltbot Architecture: The Executive Layer
Moltbot acts as the "Standardized Entry Point" for complex, multi-stage automated content production.

### 1.1 Task Decomposition Logic (DAG)
*   **The Blueprint:** Decomposing a high-level user request (e.g., "Create a 5-minute documentary on Quantum Computing") into a Directed Acyclic Graph (DAG).
*   **Node Types:**
    *   **Reasoning Nodes:** LLMs defining structure and research.
    *   **Generation Nodes:** BPY/Manim script generation.
    *   **Assembly Nodes:** DaVinci Resolve timeline orchestration.
    *   **Verification Nodes:** Quality assurance and feedback loops.

### 1.2 Multi-Agent Coordination Protocols
*   **Stateful Handoffs:** Utilizing a central **Memory Store** (JSON/SQLite) to pass variables between agents without context loss.
*   **Context Pruning:** Automatically stripping irrelevant worker logs to keep the orchestrator's context window clean.

---

## 2. Cross-Modal Synchronization Protocols
Ensuring that data from one agent (e.g., timing from a script) matches the generation of another (e.g., visual length).

### 2.1 The "Time-Stamp" Registry
*   **Logic:** Every line of text generated by the *Screenwriter* must have a calculated duration based on target WPM (Words Per Minute).
*   **Visual Alignment:** The *Visual Director* receives these timestamps to set the `frame_end` of procedural animations.

### 2.2 Shared Asset Manifest
A centralized JSON manifest tracking all generated assets (WAV, PNG, MP4, .blend) to prevent re-generation and enable efficient assembly.

---

## 3. High-Performance Orchestration (2025)
*   **Async Fan-out:** Running research and visual brainstorming in parallel across multiple worker instances.
*   **Dynamic Re-routing:** If a worker fails (e.g., Blender crash), the orchestrator triggers a retry or fallback logic (e.g., switching to Manim).

---

## 4. Technical Appendix: Orchestrator CLI & Config
| Parameter | Technical Purpose | Standard |
| :--- | :--- | :--- |
| `max_iterations` | Cap on self-correction loops | 3 |
| `consensus_threshold`| Required agreement between 2+ agents | 0.8 |
| `timeout_per_node` | Hard cutoff for worker execution | 300s |
| `cache_strategy` | Persistent storage of intermediate nodes | 'Strict' |

---

## 5. Industrial Case Study: Full Video Production Pipeline
**Objective:** Generating a technical tutorial from a README file.
1.  **Ingestion:** Moltbot reads the README and triggers `storyteller-clil` for scripting.
2.  **Scene Mapping:** Moltbot maps script paragraphs to `Manim` equations or `Blender` 3D views.
3.  **Parallel Execution:** `audio-processing` and `visual-generation` run in parallel.
4.  **Final Assembly:** Moltbot generates the `.drp` (Resolve) or FFmpeg concatenation command for the final output.

---

## 6. Glossary of Moltbot Terms
*   **Orchestrator:** The central agent that manages the DAG and state.
*   **Worker:** A specialized agent with a restricted toolset.
*   **Molt:** The transition state between two agent outputs.
*   **Semantic Handoff:** A handoff that includes the "Rationale" behind the data, not just the raw data.

---

## 7. Mathematical Foundations: Task Priority Math
*   **Weighted Shortest Job First (WSJF):** An algorithm used by Moltbot to prioritize which nodes to execute first to minimize overall production latency.
*   **Similarity Scoring:** Using embeddings to verify that worker output matches the orchestrator's initial intent.

---

## 8. Troubleshooting & Performance Verification
*   **Orchestration Deadlocks:** Occurs when two nodes have circular dependencies. *Fix: DAG validation before execution.*
*   **Hallucinated Handoffs:** Workers providing invalid JSON variables. *Fix: Strict Pydantic validation on all inter-agent messages.*

---

## 9. Appendix: Future "Moltbot" Extensions
*   **Long-Term Memory (Leitner Integration):** Tracking which technical terms the user has learned to adjust script complexity dynamically.

---

## 10. Benchmarks & Performance Targets (2025)
*   **Orchestration Overhead:** < 5% of total compute time.
*   **State Consistency:** 100% agreement on shared asset manifest across all agents.

---
[Back to README](../../README.md)
